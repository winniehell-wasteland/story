<!DOCTYPE html>
<html>
<head lang="en">
    <meta charset="UTF-8"/>
    <title>A story</title>
    <link rel="stylesheet" href="css/style.css" type="text/css"/>
</head>
<body>

<div id="content">
    <div class="left page">
    </div>

    <div class="right page">
        <h3>Du bist Fred!</h3>
        <img src="img/awake.png"/>

        <hr>

        <p>
            <button data-action="eatCookie">Keks essen</button>
        </p>
        <p>
            <button data-action="eatCake">Kuchen essen</button>
        </p>
        <p>
            <button data-action="sleep">schlafen</button>
        </p>
    </div>
</div>

<script src="js/jquery-2.1.4.min.js"></script>
<script src="lib/Story.js"></script>
<script>
    $(document).ready(function() {
        var actionButtons = $('button');
        var story = new Story($('.left.page'));

        function setEnabledActions(enabledActions, immediately) {
            function isDisabledAction() {
                return enabledActions.indexOf($(this).data('action')) < 0;
            }

            actionButtons.prop('disabled', isDisabledAction);

            var fadeOptions = {
                duration: immediately ? 0 : 'slow',
                queue: false,
            };
            actionButtons.filter(':disabled').fadeOut(fadeOptions);
            actionButtons.not(':disabled').fadeIn(fadeOptions);
        }

        function performAction(action) {
            if (action === 'eatCake') {
                story.addContent('Fred isst einen Kuchen. Davon wird er müde...');
                setEnabledActions(['sleep']);
            } else if (action === 'eatCookie') {
                story.addContent('Fred isst einen Keks. Der ist lecker!');
            } else if (action === 'sleep') {
                setEnabledActions([]);
                story.addContent('Fred schläft...');
                $('img').attr('src', 'img/sleeping.png');

                setTimeout(function() {
                    $('img').attr('src', 'img/awake.png');
                    setEnabledActions(['eatCake',
                        'eatCookie'
                    ]);
                    story.clearContent();
                    story.addContent('Fred ist aufgewacht.');
                }, 2000);
            }
        }

        actionButtons.on('click', function(e) {
            e.preventDefault();
            performAction($(this).data('action'));
            return false;
        });

        setEnabledActions(['eatCake',
            'eatCookie'
        ], true);

        $('#content').fadeIn('slow');
    });
</script>
</body>
</html>